---
title: "DHS"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r import}
library(haven)
library(dplyr)
library(survey)
library(ggplot2)
source("df_functions.R")
#load("Cleaned DHS")

bnir <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Benin/IR/BJIR71FL.DTA")
#bfir <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Burkina Faso/IR/BFIR62FL.DTA")
ciir <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Cote d'Ivoire/IR/CIIR62FL.DTA")
cmir <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Cameroon/IR/CMIR71FL.DTA")
keir <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Kenya/IR/KEIR72FL.DTA")
lsir09 <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Lesotho/2009/IR/LSIR61FL.DTA")
lsir14 <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Lesotho/2014/IR/LSIR71FL.DTA")
nmir00 <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Namibia/2000/IR/NMIR41FL.DTA")
nmir13 <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Namibia/2013/IR/NMIR61FL.DTA")
sair <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/South Africa/2016/IR/ZAIR71FL.DTA")
saahw <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/South Africa/2016/AH/ZAAHW71FL.DTA")
tzir <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Tanzania/IR/TZIR6AFL.DTA")
zwir <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Zimbabwe/IR/ZWIR72FL.DTA")

cibio <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Cote d'Ivoire/HIV/CIAR61FL.DTA")
cmbio <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Cameroon/HIV/CMAR71FL.DTA")
lsbio09 <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Lesotho/2009/HIV/LSAR61FL.DTA")
lsbio14 <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Lesotho/2014/HIV/LSAR72FL.DTA")
nmbio <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Namibia/2013/HIV/NMAR61FL.DTA")
sabio <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/South Africa/2016/HIV/ZAAR71FL.DTA")
tzbio <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Tanzania/HIV/TZAR6AFL.DTA")
zwbio <- read_dta("~/Documents/GitHub/HPV-HIV-Model/DHS/Surveys/Zimbabwe/HIV/ZWAR71FL.DTA")
```

# Clean survey data
```{r Benin}
bndhs <- select(bnir,
                c(psu = v001,
                  weight_raw = v005,
                  Year = v007,
                  cdc = v008a,
                  age = v012,
                  agegr = v013,
                  strata = v022,
                  region = v024,
                  #cervical cancer questions
                  heard_of_cc = s1423,
                  heard_of_cc_test = s1424,
                  ever_cc_tested = s1426,
                  last_cc_test = s1427,
                  last_cc_test_result = s1428,
                  last_cc_test_fu = s1429))

bndhs$weight = bndhs$weight_raw/1e6
bndhs$Country = "Benin"
bndhs$df = "bndhs"
bndhs <- zap_labels(bndhs)
  
#Recode
##cervical cancer questions
bndhs$ever_cc_tested[bndhs$ever_cc_tested == 8] <- NA #making answers of don't know = NA

#create cc test past 1, 3, and 5 Year question among everyone
bndhs$cc_test_past_3y[!is.na(bndhs$ever_cc_tested)] <- 0
bndhs$cc_test_past_3y[bndhs$ever_cc_tested == 1 & bndhs$last_cc_test <= 3] <- 1

bndhs$cc_test_past_1y[!is.na(bndhs$ever_cc_tested)] <- 0
bndhs$cc_test_past_1y[bndhs$ever_cc_tested == 1 & bndhs$last_cc_test <= 1] <- 1

bndhs$cc_test_past_5y[!is.na(bndhs$ever_cc_tested)] <- 0
bndhs$cc_test_past_5y[bndhs$ever_cc_tested == 1 & bndhs$last_cc_test <= 5] <- 1

#clean cc test results
bndhs$last_cc_test_result[bndhs$last_cc_test_result == 8] <- NA

#create var for received cc test results
bndhs$last_cc_test_result_received[!is.na(bndhs$last_cc_test_result)] <- 0
bndhs$last_cc_test_result_received[bndhs$last_cc_test_result != 4] <- 1
bndhs$last_cc_test_result_received[bndhs$last_cc_test_result == 8] <- NA

#create variable for positive result on last cc test
bndhs$last_cc_test_pos[bndhs$last_cc_test_result == 1] <- 0
bndhs$last_cc_test_pos[bndhs$last_cc_test_result == 2] <- 1

#find year at the midpoint of data
design <- svydesign(data = bndhs, weights = ~weight, id = ~psu) #may need to add strata
svymean(~cdc, design = design, vartype = "ci", method = "beta") #43102 is in 2018
```
```{r Cameroon}
cmir2 <- left_join(cmir, cmbio, by=c("v001" = "hivclust", "v002" = "hivnumb", "v003" = "hivline"))
cmdhs <- select(cmir2,
                c(psu = v001,
                  weight_raw = v005,
                  Year = v007,
                  age = v012,
                  agegr = v013,
                  strata = v022,
                  region = v024,
                  #cervical cancer questions,
                  heard_of_cc = s1223,
                  heard_of_cc_test = s1224,
                  ever_cc_tested = s1226,
                  last_cc_test = s1227,
                  last_cc_test_results = s1228,
                  cc_test_fu = s1229,
                  #hiv testing
                  hiv03,
                  hiv_weight_raw = hiv05))

cmdhs$weight <- cmdhs$weight_raw/1e6
cmdhs$hiv_weight <- cmdhs$hiv_weight_raw/1e6
cmdhs$Country <- "Cameroon"
cmdhs$df = "cmdhs"
cmdhs <- zap_labels(cmdhs)

#Recode
##cervical cancer questions
cmdhs$ever_cc_tested[cmdhs$ever_cc_tested == 8] <- NA #making answers of don't know = NA
cmdhs$last_cc_test[cmdhs$last_cc_test == 98] <- NA #making answers of don't know = NA
cmdhs$last_cc_test_results[cmdhs$last_cc_test_results == 8] <- NA #making answers of don't know = NA

#create cc test past 3 Year question among everyone
cmdhs$cc_test_past_3y <- NA
cmdhs$cc_test_past_3y[!is.na(cmdhs$ever_cc_tested)] <- 0
cmdhs$cc_test_past_3y[cmdhs$ever_cc_tested == 1 & cmdhs$last_cc_test <= 3] <- 1

#creating hivstat variable
cmdhs$hivstat <- NA
cmdhs$hivstat[cmdhs$hiv03 == 1 | cmdhs$hiv03 == 2 | cmdhs$hiv03 == 3] <- 1
cmdhs$hivstat[cmdhs$hiv03 == 0] <- 0

hivp_cmdhs <- filter(cmdhs, hivstat == 1)
hivn_cmdhs <- filter(cmdhs, hivstat == 0)
```
```{r Cote dIvoire}
ciir2 <- left_join(ciir, cibio, by=c("v001" = "hivclust", "v002" = "hivnumb", "v003" = "hivline"))
cidhs <- select(ciir2,
                c(psu = v001,
                  weight_raw = v005,
                  Year = v007,
                  cmc = v008,
                  age = v012,
                  agegr = v013,
                  strata = v022,
                  region = v024,
                  #cervical cancer questions,
                  heard_of_cc = s1011c,
                  ever_cc_tested = s1011d,
                  #hiv testing
                  hiv03,
                  hiv_weight_raw = hiv05))

cidhs$weight <- cidhs$weight_raw/1e6
cidhs$hiv_weight <- cidhs$hiv_weight_raw/1e6
cidhs$Country <- "Cote d'Ivoire"
cidhs$df = "cidhs"
cidhs <- zap_labels(cidhs)

#Recode
##cervical cancer questions
#not sure if making all the don't knows into NA's is the right move here
cidhs$heard_of_cc[cidhs$heard_of_cc == 8] <- NA
cidhs$ever_cc_tested[cidhs$ever_cc_tested == 8] <- NA #making answers of don't know = NA
cidhs$ever_cc_tested[cidhs$heard_of_cc == 0] <- 0 #ever cc tested only asked to those who have heard of cc, so making this change to keep the denominator among all women
cidhs$ever_cc_tested[cidhs$heard_of_cc == 8] <- 8

#creating hivstat variable
cidhs$hivstat <- NA
cidhs$hivstat[cidhs$hiv03 == 1 | cidhs$hiv03 == 2 | cidhs$hiv03 == 3] <- 1
cidhs$hivstat[cidhs$hiv03 == 0] <- 0

hivp_cidhs <- filter(cidhs, hivstat == 1)
hivn_cidhs <- filter(cidhs, hivstat == 0)

#find year at the midpoint of data
design <- svydesign(data = cidhs, weights = ~weight, id = ~psu) #may need to add strata
svymean(~cmc, design = design, vartype = "ci", method = "beta") #1345 months is in 2012
```
```{r Kenya}
kedhs <- select(keir,
                c(psu = v001,
                  weight_raw = v005,
                  Year = v007,
                  age = v012,
                  agegr = v013,
                  strata = v022,
                  region = v024,
                  #cervical cancer questions
                  heard_of_cc = s1008a,
                  ever_cc_tested = s1008b,
                  cc_test_pap_smear = s1008ca,
                  cc_test_vi = s1008cb,
                  cc_test_dk = s1008cx))

kedhs$weight = kedhs$weight_raw/1e6
kedhs$Country = "Kenya"
kedhs$df = "kedhs"
kedhs <- zap_labels(kedhs)

#Recode
##cervical cancer questions
kedhs$ever_cc_tested[kedhs$heard_of_cc == 0] <- 0 #ever cc tested only asked to those who have heard of cc, so making this change to keep the denominator among all women

#creating variables for ever tested for different types of test
kedhs$ever_had_pap_smear <- kedhs$cc_test_pap_smear
kedhs$ever_had_pap_smear[kedhs$ever_cc_tested == 0] <- 0
kedhs$ever_had_pap_smear[is.na(kedhs$ever_cc_tested)] <- NA

kedhs$ever_had_vi <- kedhs$cc_test_vi
kedhs$ever_had_vi[kedhs$ever_cc_tested == 0] <- 0
```
```{r Lesotho 2009}
lsir092 <- left_join(lsir09, lsbio09, by=c("v001" = "hivclust", "v002" = "hivnumb", "v003" = "hivline"))
ls9dhs <- select(lsir092,
                c(psu = v001,
                  weight_raw = v005,
                  Year = v007,
                  age = v012,
                  agegr = v013,
                  strata = v022,
                  region = v024,
                  #cervical cancer questions
                  heard_of_pap_smear = s1012l,
                  ever_had_pap_smear = s1012m,
                  last_pap_smear = s1012n, #categorical
                  #hiv testing
                  hiv03,
                  hiv_weight_raw = hiv05))

ls9dhs$weight <- ls9dhs$weight_raw/1e6
ls9dhs$hiv_weight <- ls9dhs$hiv_weight_raw/1e6
ls9dhs$Country <- "Lesotho"
ls9dhs$df = "ls9dhs"
ls9dhs <- zap_labels(ls9dhs)

#Recode
##cervical cancer questions
ls9dhs$ever_had_pap_smear[ls9dhs$heard_of_pap_smear == 0] <- 0 #ever cc tested only asked to those who have heard of cc, so making this change to keep the denominator among all women

#create cc test past 3 Year question among everyone
ls9dhs$pap_smear_past_3y[!is.na(ls9dhs$ever_had_pap_smear)] <- 0
ls9dhs$pap_smear_past_3y[ls9dhs$ever_had_pap_smear == 1 & ls9dhs$last_pap_smear <= 2] <- 1 

ls9dhs$pap_smear_past_1y[!is.na(ls9dhs$ever_had_pap_smear)] <- 0
ls9dhs$pap_smear_past_1y[ls9dhs$ever_had_pap_smear == 1 & ls9dhs$last_pap_smear <= 1] <- 1

#creating hivstat variable
ls9dhs$hivstat <- NA
ls9dhs$hivstat[ls9dhs$hiv03 == 1 | ls9dhs$hiv03 == 2 | ls9dhs$hiv03 == 3] <- 1
ls9dhs$hivstat[ls9dhs$hiv03 == 0] <- 0

hivp_ls9dhs <- filter(ls9dhs, hivstat == 1)
hivn_ls9dhs <- filter(ls9dhs, hivstat == 0)
```
```{r Lesotho 2014}
lsir142 <- left_join(lsir14, lsbio14, by=c("v001" = "hivclust", "v002" = "hivnumb", "v003" = "hivline"))
ls14dhs <- select(lsir142,
                c(psu = v001,
                  weight_raw = v005,
                  Year = v007,
                  age = v012,
                  agegr = v013,
                  strata = v022,
                  region = v024,
                  #cervical cancer questions
                  heard_of_pap_smear = s1012n,
                  ever_had_pap_smear = s1012o,
                  last_pap_smear = s1012p, #categorical
                  #hiv testing
                  hiv03,
                  hiv_weight_raw = hiv05))

ls14dhs$weight <- ls14dhs$weight_raw/1e6
ls14dhs$hiv_weight <- ls14dhs$hiv_weight_raw/1e6
ls14dhs$Country <- "Lesotho"
ls14dhs$df = "ls14dhs"
ls14dhs <- zap_labels(ls14dhs)

#Recode
##determinants
##cervical cancer questions
ls14dhs$ever_had_pap_smear[ls14dhs$heard_of_pap_smear == 0] <- 0

#create cc test past 3 Year question among everyone
ls14dhs$pap_smear_past_3y[!is.na(ls14dhs$ever_had_pap_smear)] <- 0
ls14dhs$pap_smear_past_3y[ls14dhs$ever_had_pap_smear == 1 & ls14dhs$last_pap_smear <= 2] <- 1

ls14dhs$pap_smear_past_1y[!is.na(ls14dhs$ever_had_pap_smear)] <- 0
ls14dhs$pap_smear_past_1y[ls14dhs$ever_had_pap_smear == 1 & ls14dhs$last_pap_smear <= 1] <- 1

#creating hivstat variable
ls14dhs$hivstat <- NA
ls14dhs$hivstat[ls14dhs$hiv03 == 1 | ls14dhs$hiv03 == 2 | ls14dhs$hiv03 == 3] <- 1
ls14dhs$hivstat[ls14dhs$hiv03 == 0] <- 0

hivp_ls14dhs <- filter(ls14dhs, hivstat == 1)
hivn_ls14dhs <- filter(ls14dhs, hivstat == 0)
```
```{r Namibia 2000}
nm0dhs <- select(nmir00,
                c(psu = v001,
                  weight_raw = v005,
                  Year = v007,
                  age = v012,
                  agegr = v013,
                  strata = v022,
                  region = v024,
                  #cervical cancer questions
                  ever_had_pap_smear = s484))

nm0dhs$weight <- nm0dhs$weight_raw/1e6
nm0dhs$Country <- "Namibia"
nm0dhs$df = "nm0dhs"
nm0dhs <- zap_labels(nm0dhs)

#recode
##determinants
##cervical cancer questions
nm0dhs$ever_had_pap_smear[nm0dhs$ever_had_pap_smear == 8] <- NA
```
```{r Namibia 2013}
nmir132 <- left_join(nmir13, nmbio, by=c("v001" = "hivclust", "v002" = "hivnumb", "v003" = "hivline"))
nm13dhs <- select(nmir132,
                c(psu = v001,
                  weight_raw = v005,
                  Year = v007,
                  age = v012,
                  agegr = v013,
                  strata = v022,
                  region = v024,
                  #cervical cancer questions
                  heard_of_cc = s1010n,
                  ever_cc_tested = s1010o,
                  cc_test_pap_smear = s1010p1,
                  cc_test_vi = s1010p2,
                  cc_test_dk = s1010p3,
                  #hiv testing
                  hiv03,
                  hiv_weight_raw = hiv05))

nm13dhs$weight <- nm13dhs$weight_raw/1e6
nm13dhs$hiv_weight <- nm13dhs$hiv_weight_raw/1e6
nm13dhs$Country <- "Namibia"
nm13dhs$df = "nm13dhs"
nm13dhs <- zap_labels(nm13dhs)

#recode
##cervical cancer questions
nm13dhs$ever_cc_tested[nm13dhs$heard_of_cc == 0] <- 0 #ever cc tested only asked to those who have heard of cc, so making this change to keep the denominator among all women

#changing values of don't know to NA - need to check this is appropriate
nm13dhs$ever_cc_tested[nm13dhs$ever_cc_tested == 8] <- NA
nm13dhs$cc_test_pap_smear[nm13dhs$cc_test_pap_smear == 8] <- NA
nm13dhs$cc_test_vi[nm13dhs$cc_test_vi == 8] <- NA
nm13dhs$cc_test_dk[nm13dhs$cc_test_dk == 8] <- NA

#creating variables for ever tested for different types of test
nm13dhs$ever_had_pap_smear <- nm13dhs$cc_test_pap_smear
nm13dhs$ever_had_pap_smear[nm13dhs$ever_cc_tested == 0] <- 0
nm13dhs$ever_had_pap_smear[is.na(nm13dhs$ever_cc_tested)] <- NA

nm13dhs$ever_had_vi<- nm13dhs$cc_test_vi
nm13dhs$ever_had_vi[nm13dhs$ever_cc_tested == 0] <- 0
#creating hivstat variable
nm13dhs$hivstat <- NA
nm13dhs$hivstat[nm13dhs$hiv03 == 1 | nm13dhs$hiv03 == 2 | nm13dhs$hiv03 == 3] <- 1
nm13dhs$hivstat[nm13dhs$hiv03 == 0] <- 0

hivp_nm13dhs <- filter(nm13dhs, hivstat == 1)
hivn_nm13dhs <- filter(nm13dhs, hivstat == 0)
nm13dhs <- filter(nm13dhs, weight != 0)
```
```{r South Africa}
sair2 <- left_join(saahw, sair)
sair2 <- left_join(sair2, sabio, by=c("v001" = "hivclust", "v002" = "hivnumb", "v003" = "hivline"))

sadhs <- select(sair2,
                c(psu = v001,
                  weight_raw = v005,
                  Year = v007,
                  age = v012,
                  agegr = v013,
                  strata = v022,
                  region = v024,
                  #cervical cancer questions
                  ever_had_pap_smear = s1407,
                  last_pap_smear = s1408,
                  pap_smear_results = s1409,
                  #hiv testing
                  hiv03,
                  hiv_weight_raw = hiv05))

sadhs$weight <- sadhs$weight_raw/1e6
sadhs$hiv_weight <- sadhs$hiv_weight_raw/1e6
sadhs$Country <- "South Africa"
sadhs$df = "sadhs"
sadhs <- zap_labels(sadhs)

#Recode
##cervical cancer questions
#clean pap smear related data
sadhs$ever_had_pap_smear[sadhs$ever_had_pap_smear == 8] <- NA
sadhs$pap_smear_results[sadhs$pap_smear_results == 8] <- NA

#create cc test past 3 Year question among everyone
sadhs$pap_smear_past_3y[!is.na(sadhs$ever_had_pap_smear)] <- 0
sadhs$pap_smear_past_3y[sadhs$ever_had_pap_smear == 1 & sadhs$last_pap_smear == 1] <- 1

sadhs$pap_smear_past_5y[!is.na(sadhs$ever_had_pap_smear)] <- 0
sadhs$pap_smear_past_5y[sadhs$ever_had_pap_smear == 1 & sadhs$last_pap_smear <= 2] <- 1

#clean variable for received results for last cc test
sadhs$last_cc_test_result_received[!is.na(sadhs$pap_smear_results)] <- 0
sadhs$last_cc_test_result_received[sadhs$pap_smear_results == 1] <- 1
sadhs$last_cc_test_result_received[sadhs$pap_smear_results == 8] <- NA

#creating hivstat variable
sadhs$hivstat <- NA
sadhs$hivstat[sadhs$hiv03 == 1 | sadhs$hiv03 == 2 | sadhs$hiv03 == 3] <- 1
sadhs$hivstat[sadhs$hiv03 == 0] <- 0

hivp_sadhs <- filter(sadhs, hivstat == 1)
hivn_sadhs <- filter(sadhs, hivstat == 0)

sadhs <- filter(sadhs, weight != 0)
```
```{r Tanzania}
tzir2 <- left_join(tzir, tzbio, by=c("v001" = "hivclust", "v002" = "hivnumb", "v003" = "hivline"))
tzdhs <- select(tzir2,
                c(psu = v001,
                  weight_raw = v005,
                  Year = v007,
                  cmc = v008,
                  age = v012,
                  agegr = v013,
                  strata = v022,
                  region = v024,
                  #cervical cancer questions
                  heard_of_cc = s705a,
                  talked_about_cc_past_6mo = s705b,
                  #hiv testing
                  hiv03,
                  hiv_weight_raw = hiv05))

tzdhs$weight <- tzdhs$weight_raw/1e6
tzdhs$hiv_weight <- tzdhs$hiv_weight_raw/1e6
tzdhs$Country <- "Tanzania"
tzdhs$df = "tzdhs"
tzdhs <- zap_labels(tzdhs)

#recode
##cervical cancer questions
#not sure if making all the don't knows into NA's is the right move here
tzdhs$heard_of_cc[tzdhs$heard_of_cc == 8] <- NA
tzdhs$heard_of_cc[tzdhs$heard_of_cc == 9] <- NA

#creating hivstat variable
tzdhs$hivstat <- NA
tzdhs$hivstat[tzdhs$hiv03 == 1 | tzdhs$hiv03 == 2 | tzdhs$hiv03 == 3] <- 1
tzdhs$hivstat[tzdhs$hiv03 == 0] <- 0

hivp_tzdhs <- filter(tzdhs, hivstat == 1)
hivn_tzdhs <- filter(tzdhs, hivstat == 0)

#find year at the midpoint of data
design <- svydesign(data = tzdhs, weights = ~weight, id = ~psu) #may need to add strata
svymean(~cmc, design = design, vartype = "ci", method = "beta") #1346 months is in 2012
```
```{r Zimbabwe}
zwir2 <- left_join(zwir, zwbio, by=c("v001" = "hivclust", "v002" = "hivnumb", "v003" = "hivline"))
zwdhs <- select(zwir2,
                c(psu = v001,
                  weight_raw = v005,
                  Year = v007,
                  age = v012,
                  agegr = v013,
                  strata = v022,
                  region = v024,
                  #cervical cancer questions
                  heard_of_cc = s1108aa,
                  ever_cc_tested = s1108ab,
                  last_cc_test = s1108ac,
                  last_cc_test_d = s1108acd,
                  last_cc_test_m = s1108acm,
                  last_cc_test_y = s1108acy,
                  #hiv testing
                  hiv03,
                  hiv_weight_raw = hiv05))

zwdhs$weight <- zwdhs$weight_raw/1e6
zwdhs$hiv_weight <- zwdhs$hiv_weight_raw/1e6
zwdhs$Country <- "Zimbabwe"
zwdhs$df = "zwdhs"
zwdhs <- zap_labels(zwdhs)

#Recode
##cervical cancer questions
zwdhs$ever_cc_tested[zwdhs$heard_of_cc == 0] <- 0 #ever cc tested only asked to those who have heard of cc, so making this change to keep the denominator among all women

#not sure if making all the don't knows into NA's is the right move here
zwdhs$heard_of_cc[zwdhs$heard_of_cc == 8] <- NA
zwdhs$ever_cc_tested[zwdhs$ever_cc_tested == 8] <- NA 
zwdhs$last_cc_test_m[zwdhs$last_cc_test_m == 95 | zwdhs$last_cc_test_m == 98] <- NA
zwdhs$last_cc_test_y[zwdhs$last_cc_test_y == 9998] <- NA

#create cc test past 3 Year question among everyone
zwdhs$cc_test_past_3y <- NA
zwdhs$cc_test_past_3y[!is.na(zwdhs$ever_cc_tested)] <- 0
zwdhs$cc_test_past_3y[zwdhs$ever_cc_tested == 1 & zwdhs$last_cc_test >= 401 & zwdhs$last_cc_test <= 403] <- 1 #this is done because there are months that are reported above 36 (3 years)
zwdhs$cc_test_past_3y[zwdhs$ever_cc_tested == 1 & zwdhs$last_cc_test <= 336] <- 1
zwdhs$cc_test_past_3y[zwdhs$last_cc_test >= 994] <- NA

zwdhs$cc_test_past_1y <- NA
zwdhs$cc_test_past_1y[!is.na(zwdhs$ever_cc_tested)] <- 0
zwdhs$cc_test_past_1y[zwdhs$ever_cc_tested == 1 & zwdhs$last_cc_test == 401] <- 1
zwdhs$cc_test_past_1y[zwdhs$ever_cc_tested == 1 & zwdhs$last_cc_test <= 312] <- 1
zwdhs$cc_test_past_1y[zwdhs$last_cc_test >= 994] <- NA

zwdhs$cc_test_past_5y <- NA
zwdhs$cc_test_past_5y[!is.na(zwdhs$ever_cc_tested)] <- 0
zwdhs$cc_test_past_5y[zwdhs$ever_cc_tested == 1 & zwdhs$last_cc_test <= 405] <- 1
zwdhs$cc_test_past_5y[zwdhs$last_cc_test >= 994] <- NA

#creating hivstat variable
zwdhs$hivstat <- NA
zwdhs$hivstat[zwdhs$hiv03 == 1 | zwdhs$hiv03 == 2 | zwdhs$hiv03 == 3] <- 1
zwdhs$hivstat[zwdhs$hiv03 == 0] <- 0

hivp_zwdhs <- filter(zwdhs, hivstat == 1)
hivn_zwdhs <- filter(zwdhs, hivstat == 0)
```

```{r check missing data}
bn <- select(bnir,
             agegr = v013,
             heard_of_cc = s1423,
             ever_cc_tested = s1426)
cm <- select(cmir,
             agegr = v013,
             heard_of_cc = s1223,
             ever_cc_tested = s1226)
ci <- select(ciir,
             agegr = v013,
             heard_of_cc = s1011c,
             ever_cc_tested = s1011d)
ke <- select(keir,
             agegr = v013,
             heard_of_cc = s1008a,
             ever_cc_tested = s1008b)
ls9 <- select(lsir09,
             agegr = v013,
             heard_of_cc = s1012l, #acc pap smear q but keeping name for consistency
             ever_cc_tested = s1012m)
ls14 <- select(lsir14,
             agegr = v013,
             heard_of_cc = s1012n, #acc pap smear q but keeping name for consistency
             ever_cc_tested = s1012o)
nm0 <- select(nmir00,
             agegr = v013, #acc pap smear q but keeping name for consistency
             ever_cc_tested = s484)
nm13 <- select(nmir13,
             agegr = v013, 
             heard_of_cc = s1010n,
             ever_cc_tested = s1010o)
sa <- select(saahw,
             agegr = v013, 
             ever_cc_tested = s1407)
zw <- select(zwir,
             agegr = v013, 
             heard_of_cc = s1108aa,
             ever_cc_tested = s1108ab)
dhs_list <- list(bn, ci, cm, ke, ls9, ls14, nm0, nm13, sa, zw)
names(dhs_list) <- c("bndhs", "cidhs", "cmdhs", "kedhs", "ls9dhs", 
                     "ls14dhs", "nm0dhs", "nm13dhs", "sadhs", "zwdhs")
for(i in 1:length(dhs_list)){
  print(names(dhs_list)[[i]])
  if(length(dhs_list[[i]]$heard_of_cc) > 0){
    dhs_list[[i]]$ever_cc_tested[dhs_list[[i]]$heard_of_cc == 0] <- 0
  }
}

dat_missing <- data.frame(Survey = NA,
                 agegr = NA,
                 elg_resp = NA,
                 resp = NA,
                 dk = NA,
                 missing = NA)
n=1
for(i in 1:length(dhs_list)){
  for(a in 1:length(sort(unique(dhs_list[[i]]$agegr)))){
    gr <- sort(unique(dhs_list[[i]]$agegr))[a]
    df <- filter(dhs_list[[i]], agegr == gr)
    id <- names(dhs_list)[i]
    dk <- NA
    tbl <- table(df$ever_cc_tested)
    df_tbl <- data.frame(tbl)
    
    elg_resp <- nrow(df)
    resp <- sum(tbl)
    missing <- elg_resp - resp
    
    dk <- df_tbl[df_tbl$Var1 == 8 , 2]
    if(length(dk) == 0){
      dk = 0
    }
    print(id); print(tbl)
    dat_missing[n, ] <- c(id, gr, elg_resp, resp, dk, missing)
    n=n+1
  }
}

dat_missing$agegr <- factor(dat_missing$agegr, levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10),
                            labels = c("15-19", "20-24", "25-29", "30-34", "35-39", 
                                       "40-44", "45-49", "50-54", "55-59", "60-64"))

for(i in 1:length(dhs_list)){
  print(unique(dhs_list[[i]]$df))
  print(sum(as.numeric(dat_missing[dat_missing$Survey == unique(dhs_list[[i]]$df), "dk"])))
}
table(cidhs$ever_cc_tested)
```

```{r save}
save(bndhs, cidhs, cmdhs, kedhs, ls9dhs, ls14dhs, nm0dhs, nm13dhs, sadhs, tzdhs, zwdhs, file = "New Cleaned DHS")
```
